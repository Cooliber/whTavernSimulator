<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Immersive Warhammer Fantasy Tavern Simulator - Experience living conversations in a 3D medieval tavern">
    <meta name="theme-color" content="#2c1810">
    
    <title>üè∞ Warhammer Fantasy Tavern Simulator</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="./styles/main.css" as="style">
    <link rel="preload" href="./js/main.js" as="script">
    
    <!-- Progressive Web App -->
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/icons/favicon-16x16.png">
    <link rel="apple-touch-icon" href="./assets/icons/apple-touch-icon.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="./styles/main.css">
    <link rel="stylesheet" href="./styles/conversations.css">
    <link rel="stylesheet" href="./styles/themes.css">
    <link rel="stylesheet" href="./styles/responsive.css">
    
    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Google Fonts for Warhammer atmosphere -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Uncial+Antiqua&family=MedievalSharp&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="tavern-logo">
                <h1>üè∞ Warhammer Fantasy</h1>
                <h2>Tavern Simulator</h2>
            </div>
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <div class="loading-text" id="loading-text">Initializing tavern...</div>
        </div>
        <div class="loading-particles" id="loading-particles"></div>
    </div>

    <!-- Main Application Container -->
    <main id="app" class="app-container">
        <!-- 3D Canvas for Three.js -->
        <canvas id="webgl-canvas" class="webgl-canvas"></canvas>
        
        <!-- UI Overlay -->
        <div id="ui-overlay" class="ui-overlay">
            <!-- Top HUD -->
            <header class="top-hud">
                <div class="tavern-info">
                    <h1 id="tavern-name" class="tavern-name">The Prancing Pony</h1>
                    <div class="tavern-stats">
                        <div class="stat-item">
                            <span class="stat-icon">üèÜ</span>
                            <span class="stat-label">Reputation</span>
                            <div class="stat-bar">
                                <div id="reputation-fill" class="stat-fill reputation-fill"></div>
                            </div>
                            <span id="reputation-value" class="stat-value">75</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">‚ö°</span>
                            <span class="stat-label">Tension</span>
                            <div class="stat-bar">
                                <div id="tension-fill" class="stat-fill tension-fill"></div>
                            </div>
                            <span id="tension-value" class="stat-value">25</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üí∞</span>
                            <span class="stat-label">Wealth</span>
                            <span id="wealth-value" class="stat-value">1,250</span>
                        </div>
                    </div>
                </div>
                
                <!-- Controls -->
                <div class="top-controls">
                    <button id="settings-btn" class="control-btn" title="Settings">
                        <span class="btn-icon">‚öôÔ∏è</span>
                    </button>
                    <button id="fullscreen-btn" class="control-btn" title="Fullscreen">
                        <span class="btn-icon">üî≥</span>
                    </button>
                    <button id="audio-toggle" class="control-btn active" title="Toggle Audio">
                        <span class="btn-icon">üîä</span>
                    </button>
                </div>
            </header>

            <!-- Character Panel -->
            <aside id="character-panel" class="character-panel">
                <div class="panel-header">
                    <h3>üë• Tavern Patrons</h3>
                    <button id="character-panel-toggle" class="panel-toggle">üìã</button>
                </div>
                <div class="characters-grid" id="characters-grid">
                    <!-- Characters will be populated by JavaScript -->
                </div>
            </aside>

            <!-- Conversation Display -->
            <section id="conversation-display" class="conversation-display">
                <div class="conversation-bubbles" id="conversation-bubbles">
                    <!-- Conversation bubbles will appear here -->
                </div>
            </section>

            <!-- Bottom Controls -->
            <footer class="bottom-controls">
                <div class="camera-controls">
                    <button id="camera-reset" class="control-btn" title="Reset Camera">
                        <span class="btn-icon">üé•</span>
                    </button>
                    <button id="camera-follow" class="control-btn" title="Follow Mode">
                        <span class="btn-icon">üëÅÔ∏è</span>
                    </button>
                </div>
                
                <div class="action-controls">
                    <button id="generate-event" class="action-btn primary" title="Generate Event">
                        <span class="btn-icon">üé≤</span>
                        <span class="btn-text">Generate Event</span>
                    </button>
                    <button id="trigger-conversation" class="action-btn" title="Start Conversation">
                        <span class="btn-icon">üí¨</span>
                        <span class="btn-text">Start Talk</span>
                    </button>
                    <button id="trigger-brawl" class="action-btn danger" title="Trigger Brawl">
                        <span class="btn-icon">‚öîÔ∏è</span>
                        <span class="btn-text">Start Brawl</span>
                    </button>
                </div>

                <div class="time-controls">
                    <button id="pause-btn" class="control-btn" title="Pause/Resume">
                        <span class="btn-icon">‚è∏Ô∏è</span>
                    </button>
                    <button id="speed-btn" class="control-btn" title="Speed Control">
                        <span class="btn-icon">‚è©</span>
                        <span class="speed-indicator">1x</span>
                    </button>
                </div>
            </footer>
        </div>

        <!-- Settings Panel -->
        <div id="settings-panel" class="settings-panel hidden">
            <div class="settings-content">
                <div class="settings-header">
                    <h3>‚öôÔ∏è Settings</h3>
                    <button id="settings-close" class="close-btn">‚úï</button>
                </div>
                
                <div class="settings-sections">
                    <section class="settings-section">
                        <h4>üé® Visual</h4>
                        <div class="setting-item">
                            <label for="theme-select">Theme:</label>
                            <select id="theme-select" class="setting-select">
                                <option value="dark-fantasy">Dark Fantasy</option>
                                <option value="blood-moon">Blood Moon</option>
                                <option value="golden-age">Golden Age</option>
                                <option value="shadow-realm">Shadow Realm</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="quality-select">Graphics Quality:</label>
                            <select id="quality-select" class="setting-select">
                                <option value="ultra">Ultra</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="particles-toggle" checked>
                                Enable Particle Effects
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="animations-toggle" checked>
                                Enable Animations
                            </label>
                        </div>
                    </section>

                    <section class="settings-section">
                        <h4>üîä Audio</h4>
                        <div class="setting-item">
                            <label for="master-volume">Master Volume:</label>
                            <input type="range" id="master-volume" min="0" max="100" value="70" class="volume-slider">
                            <span class="volume-value">70%</span>
                        </div>
                        <div class="setting-item">
                            <label for="music-volume">Music Volume:</label>
                            <input type="range" id="music-volume" min="0" max="100" value="50" class="volume-slider">
                            <span class="volume-value">50%</span>
                        </div>
                        <div class="setting-item">
                            <label for="sfx-volume">Sound Effects:</label>
                            <input type="range" id="sfx-volume" min="0" max="100" value="80" class="volume-slider">
                            <span class="volume-value">80%</span>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="spatial-audio" checked>
                                3D Spatial Audio
                            </label>
                        </div>
                    </section>

                    <section class="settings-section">
                        <h4>üéÆ Controls</h4>
                        <div class="setting-item">
                            <label for="camera-sensitivity">Camera Sensitivity:</label>
                            <input type="range" id="camera-sensitivity" min="0.1" max="2.0" step="0.1" value="1.0" class="sensitivity-slider">
                            <span class="sensitivity-value">1.0x</span>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="auto-camera" checked>
                                Auto Camera Follow
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="reduced-motion">
                                Reduce Motion (Accessibility)
                            </label>
                        </div>
                    </section>
                </div>

                <div class="settings-footer">
                    <button id="settings-reset" class="btn secondary">Reset to Defaults</button>
                    <button id="settings-apply" class="btn primary">Apply Changes</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Performance Monitor (Development) -->
    <div id="performance-monitor" class="performance-monitor hidden">
        <div class="perf-item">
            <span class="perf-label">FPS:</span>
            <span id="fps-counter" class="perf-value">60</span>
        </div>
        <div class="perf-item">
            <span class="perf-label">Memory:</span>
            <span id="memory-counter" class="perf-value">0 MB</span>
        </div>
        <div class="perf-item">
            <span class="perf-label">Triangles:</span>
            <span id="triangles-counter" class="perf-value">0</span>
        </div>
    </div>

    <!-- External Libraries -->
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- GSAP Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/TextPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/MorphSVGPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/DrawSVGPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/PixiPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Flip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/CustomEase.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Draggable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/MotionPathPlugin.min.js"></script>
    
    <!-- Audio Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    
    <!-- Application Scripts -->
    <script type="module" src="./js/main.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('üîß Service Worker registered successfully');
                    })
                    .catch(error => {
                        console.log('‚ùå Service Worker registration failed');
                    });
            });
        }
    </script>
</body>
</html>